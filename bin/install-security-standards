#!/usr/bin/env php
<?php
/**
 * Installation script for Common Security Standards
 */

echo "Installing Common Security Standards...\n";

// Check if PHPCS is installed
$phpcsPath = shell_exec('which phpcs');
if (empty($phpcsPath)) {
    echo "Error: PHP_CodeSniffer not found. Please install it first.\n";
    echo "Run: composer global require squizlabs/php_codesniffer\n";
    exit(1);
}

// Get PHPCS installed standards path
$installedPaths = shell_exec('phpcs --config-show installed_paths 2>/dev/null');
$currentPaths = '';
if ($installedPaths && strpos($installedPaths, 'installed_paths:') !== false) {
    $currentPaths = trim(str_replace('installed_paths:', '', $installedPaths));
}

// Get the path to this package
$packagePath = dirname(__DIR__);

// Add our standards path
$newPaths = empty($currentPaths) ? $packagePath : $currentPaths . ',' . $packagePath;

// Set the new installed paths
$result = shell_exec("phpcs --config-set installed_paths '{$newPaths}' 2>&1");

if ($result === null) {
    echo "Security standards installed successfully!\n";
} else {
    echo "Installation completed with output: {$result}\n";
}

echo "\nAvailable rulesets:\n";
echo "  - CommonSecurity (strict security rules)\n";
echo "  - CommonSecurity/Flexible (customizable security rules)\n";
echo "\nUsage in your phpcs.xml:\n";
echo "  <rule ref=\"CommonSecurity\"/>\n";
echo "\nTo verify installation, run:\n";
echo "  phpcs -i\n";
echo "\nYou should see 'CommonSecurity' in the list of installed standards.\n";
